<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Employees</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiMxMGI5ODEiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMTYgMjF2LTJhNCA0IDAgMCAwLTQtNEg2YTQgNCAwIDAgMC00IDR2MiI+PC9wYXRoPjxjaXJjbGUgY3g9IjkiIGN5PSI3IiByPSI0Ij48L2NpcmNsZT48cGF0aCBkPSJtMjIgMjEtMy0zIj48L3BhdGg+PHBhdGggZD0ibTIyIDIxLTMtMyI+PC9wYXRoPjwvc3ZnPg==">

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes slide-down {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fade-in {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse-gentle {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.8;
      }
    }

    @keyframes modal-appear {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .animate-slide-down {
      animation: slide-down 0.6s ease-out;
    }

    .animate-fade-in {
      animation: fade-in 0.4s ease-out;
    }

    .animate-pulse-gentle {
      animation: pulse-gentle 2s infinite;
    }

    .animate-modal-appear {
      animation: modal-appear 0.3s ease-out;
    }

    .role-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .role-badge.staff {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }

    .role-badge.admin {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
    }

    .table-row {
      transition: all 0.2s ease;
    }

    .table-row:hover {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(16, 185, 129, 0.05));
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      transform: translateX(400px);
      opacity: 0;
      transition: all 0.3s ease;
    }

    .notification.show {
      transform: translateX(0);
      opacity: 1;
    }

    .notification.success {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
    }

    .notification.error {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
    }

    .modal-overlay {
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-emerald-50 via-blue-50 to-teal-100">
  <!-- Notification System -->
  <div id="notification" class="notification px-6 py-4 rounded-lg shadow-lg backdrop-blur-sm">
    <div class="flex items-center">
      <div id="notificationIcon" class="mr-3"></div>
      <span id="notificationText"></span>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="fixed inset-0 z-50 hidden">
    <div class="modal-overlay absolute inset-0" onclick="closeEditModal()"></div>
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-auto animate-modal-appear relative z-10">
        <div class="px-6 py-4 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-t-2xl">
          <h3 class="text-xl font-semibold flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
              <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
              <path d="m15 5 4 4"/>
            </svg>
            Edit Employee
          </h3>
        </div>

        <form id="editEmployeeForm" class="p-6 space-y-4">
          <input type="hidden" id="editEmployeeId">

          <!-- Full Name -->
          <div class="space-y-2">
            <label class="text-sm font-medium text-gray-700 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-emerald-500">
                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
              Full Name
            </label>
            <input type="text" id="editName" name="name" required
                   class="w-full px-4 py-3 bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200">
          </div>

          <!-- Profile Photo Upload
          <div class="space-y-2">
            <label class="text-sm font-medium text-gray-700 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-pink-500">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="9" cy="9" r="2"/>
                <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
              </svg>
              Update Profile Photo
            </label>
            <div class="relative">
              <input type="file" id="editProfilePhoto" name="profile_photo" accept="image/*"
                     class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
                     onchange="handlePhotoUpload(this, 'editPhotoPreview')">
              <div class="w-full px-4 py-3 bg-gradient-to-r from-pink-50 to-rose-50 border border-pink-200 rounded-xl border-dashed hover:border-pink-400 transition-all duration-200 cursor-pointer">
                <div class="flex items-center justify-center space-x-3">
                  <div id="editPhotoPreview" class="w-12 h-12 bg-gradient-to-br from-pink-400 to-rose-500 rounded-full flex items-center justify-center text-white font-bold overflow-hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/>
                      <circle cx="12" cy="13" r="3"/>
                    </svg>
                  </div>
                  <div class="text-center">
                    <p class="text-sm text-gray-600">Click to update photo</p>
                    <p class="text-xs text-gray-400">JPG, PNG up to 5MB</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
		   -->

          <!-- Email -->
          <div class="space-y-2">
            <label class="text-sm font-medium text-gray-700 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-blue-500">
                <path d="m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7"></path>
                <rect x="2" y="4" width="20" height="16" rx="2"></rect>
              </svg>
              Email Address
            </label>
            <input type="email" id="editEmail" name="email" required
                   class="w-full px-4 py-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
          </div>

          <!-- Phone -->
          <div class="space-y-2">
            <label class="text-sm font-medium text-gray-700 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-purple-500">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
              </svg>
              Phone (Optional)
            </label>
            <input type="text" id="editPhone" name="phone"
                   class="w-full px-4 py-3 bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200">
          </div>

          <!-- Password -->
          <div class="space-y-2">
            <label class="text-sm font-medium text-gray-700 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-orange-500">
                <rect width="18" height="11" x="3" y="11" rx="2" ry="2"></rect>
                <path d="m7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
              New Password (leave empty to keep current)
            </label>
            <input type="password" id="editPassword" name="password"
                   class="w-full px-4 py-3 bg-gradient-to-r from-orange-50 to-yellow-50 border border-orange-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200">
          </div>

          <!-- Role -->
          <div class="space-y-2">
            <label class="text-sm font-medium text-gray-700 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-indigo-500">
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              Role
            </label>
            <select id="editRole" name="role"
                    class="w-full px-4 py-3 bg-gradient-to-r from-indigo-50 to-blue-50 border border-indigo-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200">
              <option value="staff">Staff</option>
              <option value="admin">Admin</option>
            </select>
          </div>

          <!-- Buttons -->
          <div class="flex space-x-3 pt-4">
            <button type="button" onclick="closeEditModal()"
                    class="flex-1 px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-xl transition-all duration-200">
              Cancel
            </button>
            <button type="submit"
                    class="flex-1 px-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200">
              Update Employee
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="container mx-auto px-4 py-8">
    <!-- Header Section -->
    <div class="mb-8 transform animate-slide-down">
      <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 overflow-hidden">
        <header class="relative px-8 py-6 bg-gradient-to-r from-emerald-600 to-teal-700 text-white">
          <!-- Decorative Elements -->
          <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"></div>
          <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full translate-y-12 -translate-x-12"></div>

          <div class="relative flex items-center">
            <div class="flex items-center">
              <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mr-4">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="m22 21-3-3"></path>
                  <path d="m22 21-3-3"></path>
                </svg>
              </div>
              <div>
                <h1 class="text-3xl font-bold tracking-tight">Employee Management</h1>
                <p class="text-emerald-100 mt-1">Manage your team members and access controls</p>
              </div>
            </div>
          </div>
        </header>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Search Bar Section -->
      <div class="lg:col-span-3 mb-6">
        <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 overflow-hidden">
          <div class="px-6 py-4 bg-gradient-to-r from-purple-500 to-indigo-600 text-white">
            <h2 class="text-xl font-semibold flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
              Search Visitors
            </h2>
          </div>

          <div class="p-6">
            <div class="flex-1 max-w-md mx-auto">
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                  </svg>
                </div>
                <input type="text" id="visitorSearch" placeholder="Search visitors by name, email, or phone..."
                       class="w-full pl-10 pr-4 py-3 bg-white/50 backdrop-blur-sm border border-white/30 rounded-xl text-gray-700 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200">
              </div>

              <!-- Search Results -->
              <div id="searchResults" class="mt-4 hidden">
                <div class="bg-white/70 backdrop-blur-sm rounded-xl border border-white/40 shadow-lg">
                  <div class="p-4">
                    <h3 class="text-sm font-semibold text-gray-700 mb-3">Search Results</h3>
                    <div id="searchResultsList" class="space-y-2 max-h-60 overflow-y-auto">
                      <!-- Search results will be populated here -->
                    </div>
                  </div>
                </div>
              </div>

              <!-- No Results Message -->
              <div id="noResults" class="mt-4 hidden">
                <div class="bg-gray-50/70 backdrop-blur-sm rounded-xl border border-gray-200/40 p-4 text-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-gray-400 mb-2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                  </svg>
                  <p class="text-gray-500 text-sm">No visitors found matching your search.</p>
                </div>
              </div>

              <!-- Loading State -->
              <div id="searchLoading" class="mt-4 hidden">
                <div class="bg-blue-50/70 backdrop-blur-sm rounded-xl border border-blue-200/40 p-4 text-center">
                  <svg class="animate-spin h-5 w-5 text-blue-500 mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  <p class="text-blue-600 text-sm">Searching visitors...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Add Employee Form -->
      <div class="lg:col-span-1 transform animate-fade-in">
        <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 overflow-hidden">
          <div class="px-6 py-4 bg-gradient-to-r from-blue-500 to-indigo-600 text-white">
            <h2 class="text-xl font-semibold flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <line x1="22" y1="11" x2="16" y2="11"></line>
                <line x1="19" y1="8" x2="19" y2="14"></line>
              </svg>
              Add New Employee
            </h2>
          </div>

          <div class="p-6">
            <form id="employeeForm" class="space-y-4">
              <!-- Full Name -->
              <div class="space-y-2">
                <label class="text-sm font-medium text-gray-700 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-emerald-500">
                    <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  Full Name
                </label>
                <input type="text" name="name" required
                       class="w-full px-4 py-3 bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200">
              </div>

              <!-- Profile Photo Upload -->
              <div class="space-y-2">
                <label class="text-sm font-medium text-gray-700 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-pink-500">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <circle cx="9" cy="9" r="2"/>
                    <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                  </svg>
                  Profile Photo (Optional)
                </label>
                <div class="relative">
                  <input type="file" id="profilePhoto" name="profile_photo" accept="image/*"
                         class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
                         onchange="handlePhotoUpload(this, 'photoPreview')">
                  <div class="w-full px-4 py-3 bg-gradient-to-r from-pink-50 to-rose-50 border border-pink-200 rounded-xl border-dashed hover:border-pink-400 transition-all duration-200 cursor-pointer">
                    <div class="flex items-center justify-center space-x-3">
                      <div id="photoPreview" class="w-12 h-12 bg-gradient-to-br from-pink-400 to-rose-500 rounded-full flex items-center justify-center text-white font-bold">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/>
                          <circle cx="12" cy="13" r="3"/>
                        </svg>
                      </div>
                      <div class="text-center">
                        <p class="text-sm text-gray-600">Click to upload photo</p>
                        <p class="text-xs text-gray-400">JPG, PNG up to 5MB</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Email -->
              <div class="space-y-2">
                <label class="text-sm font-medium text-gray-700 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-blue-500">
                    <path d="m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7"></path>
                    <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                  </svg>
                  Email Address
                </label>
                <input type="email" name="email" required
                       class="w-full px-4 py-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
              </div>

              <!-- Phone -->
              <div class="space-y-2">
                <label class="text-sm font-medium text-gray-700 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-purple-500">
                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                  </svg>
                  Phone (Optional)
                </label>
                <input type="text" name="phone"
                       class="w-full px-4 py-3 bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200">
              </div>

              <!-- Password -->
              <div class="space-y-2">
                <label class="text-sm font-medium text-gray-700 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-orange-500">
                    <rect width="18" height="11" x="3" y="11" rx="2" ry="2"></rect>
                    <path d="m7 11V7a5 5 0 0 1 10 0v4"></path>
                  </svg>
                  Password
                </label>
                <input type="password" name="password" required
                       class="w-full px-4 py-3 bg-gradient-to-r from-orange-50 to-yellow-50 border border-orange-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200">
              </div>

              <!-- Role -->
              <div class="space-y-2">
                <label class="text-sm font-medium text-gray-700 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-indigo-500">
                    <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  Role
                </label>
                <select name="role"
                        class="w-full px-4 py-3 bg-gradient-to-r from-indigo-50 to-blue-50 border border-indigo-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200">
                  <option value="staff">Staff</option>
                  <option value="admin">Admin</option>
                </select>
              </div>

              <!-- Submit Button -->
              <button type="submit"
                      class="w-full px-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 active:scale-95 mt-6">
                <span class="flex items-center justify-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                  </svg>
                  Add Employee
                </span>
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- Employee Table -->
      <div class="lg:col-span-2 transform animate-fade-in" style="animation-delay: 0.2s;">
        <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 overflow-hidden">
          <div class="px-6 py-4 bg-gradient-to-r from-indigo-500 to-purple-600 text-white">
            <h2 class="text-xl font-semibold flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="m22 21-3-3"></path>
                <path d="m22 21-3-3"></path>
              </svg>
              Current Employees
              <span id="employeeCount" class="ml-auto bg-white/20 px-3 py-1 rounded-full text-sm">0</span>
            </h2>
          </div>

          <div class="p-6">
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead>
                  <tr class="border-b border-gray-200">
                    <th class="text-left py-2 px-3 font-semibold text-gray-700 whitespace-nowrap">ID</th>
                    <th class="text-left py-2 px-3 font-semibold text-gray-700 whitespace-nowrap">Photo</th>
                    <th class="text-left py-2 px-3 font-semibold text-gray-700 whitespace-nowrap">Name</th>
                    <th class="text-left py-2 px-3 font-semibold text-gray-700 whitespace-nowrap">Email</th>
                    <th class="text-left py-2 px-3 font-semibold text-gray-700 whitespace-nowrap">Phone</th>
                    <th class="text-left py-2 px-3 font-semibold text-gray-700 whitespace-nowrap">Role</th>
                    <th class="text-left py-2 px-3 font-semibold text-gray-700 whitespace-nowrap">Actions</th>
                  </tr>
                </thead>
                <tbody id="employeeTableBody">
                  <!-- Dynamic content will be inserted here -->
                </tbody>
              </table>

              <!-- Empty State -->
              <div id="emptyState" class="text-center py-12 hidden">
                <div class="w-24 h-24 bg-gradient-to-br from-gray-200 to-gray-300 rounded-full flex items-center justify-center mx-auto mb-4">
                  <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="m22 21-3-3"></path>
                    <path d="m22 21-3-3"></path>
                  </svg>
                </div>
                <h3 class="text-lg font-semibold text-gray-700 mb-2">No employees found</h3>
                <p class="text-gray-500">Add your first employee using the form on the left.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let currentUserRole = 'staff';
    let currentUserId = null;

    // Photo upload handler
    function handlePhotoUpload(input, previewId) {
      const file = input.files[0];
      const preview = document.getElementById(previewId);

      if (file) {
        // Validate file size (5MB max)
        if (file.size > 5 * 1024 * 1024) {
          showNotification('Photo size must be less than 5MB', 'error');
          input.value = '';
          return;
        }

        // Validate file type
        if (!file.type.match(/^image\/(jpeg|jpg|png|gif)$/)) {
          showNotification('Please select a valid image file (JPG, PNG, GIF)', 'error');
          input.value = '';
          return;
        }

        // Create preview
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.innerHTML = `<img src="${e.target.result}" alt="Preview" class="w-full h-full object-cover rounded-full">`;
        };
        reader.readAsDataURL(file);
      }
    }

    // Upload photo to server and return URL
    async function uploadPhoto(file) {
      const formData = new FormData();
      formData.append('photo', file);

      try {
        const response = await fetch('/api/upload/photo', {
          method: 'POST',
          body: formData
        });

        if (response.ok) {
          const result = await response.json();
          return result.url;
        } else {
          throw new Error('Upload failed');
        }
      } catch (error) {
        console.error('Error uploading photo:', error);
        throw error;
      }
    }

    let searchTimeout = null;

    // Visitor search functionality
    function initializeVisitorSearch() {
      const searchInput = document.getElementById('visitorSearch');
      const searchResults = document.getElementById('searchResults');
      const searchResultsList = document.getElementById('searchResultsList');
      const noResults = document.getElementById('noResults');
      const searchLoading = document.getElementById('searchLoading');

      searchInput.addEventListener('input', function(e) {
        const query = e.target.value.trim();

        if (searchTimeout) {
          clearTimeout(searchTimeout);
        }

        searchResults.classList.add('hidden');
        noResults.classList.add('hidden');
        searchLoading.classList.add('hidden');

        if (query.length < 2) {
          return;
        }

        searchLoading.classList.remove('hidden');

        searchTimeout = setTimeout(() => {
          searchVisitors(query);
        }, 500);
      });
    }

    async function searchVisitors(query) {
      const searchResults = document.getElementById('searchResults');
      const searchResultsList = document.getElementById('searchResultsList');
      const noResults = document.getElementById('noResults');
      const searchLoading = document.getElementById('searchLoading');

      try {
        const response = await fetch(`/api/visitors/search?q=${encodeURIComponent(query)}`);
        const visitors = await response.json();

        searchLoading.classList.add('hidden');

        if (visitors.length === 0) {
          noResults.classList.remove('hidden');
          return;
        }

        searchResultsList.innerHTML = '';

        visitors.forEach(visitor => {
          const resultItem = document.createElement('div');
          resultItem.className = 'p-3 bg-white/60 rounded-lg border border-white/60 hover:bg-white/80 cursor-pointer transition-all duration-200 transform hover:scale-[1.02]';
          resultItem.onclick = () => viewVisitorRegistration(visitor.id);

          resultItem.innerHTML = `
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <div class="flex items-center mb-1">
                  <div class="w-6 h-6 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-full flex items-center justify-center text-white text-xs font-bold mr-2">
                    ${visitor.name.charAt(0).toUpperCase()}
                  </div>
                  <h4 class="font-medium text-gray-900 text-sm">${visitor.name}</h4>
                </div>
                <p class="text-xs text-gray-600">${visitor.email}</p>
                ${visitor.phone ? `<p class="text-xs text-gray-500">${visitor.phone}</p>` : ''}
                ${visitor.visit_date ? `<p class="text-xs text-emerald-600">Visit: ${formatDate(visitor.visit_date)}</p>` : ''}
              </div>
              <div class="ml-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400">
                  <path d="m9 18 6-6-6-6"/>
                </svg>
              </div>
            </div>
          `;

          searchResultsList.appendChild(resultItem);
        });

        searchResults.classList.remove('hidden');

      } catch (error) {
        console.error('Error searching visitors:', error);
        searchLoading.classList.add('hidden');
        showNotification('Error searching visitors', 'error');
      }
    }

    function viewVisitorRegistration(visitorId) {
      window.location.href = `/view-registrations?visitor_id=${visitorId}`;
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // Check user permissions
    function checkUserPermissions() {
      fetch('/api/user/session')
        .then(response => {
          if (response.ok) {
            return response.json();
          }
        })
        .then(userData => {
          if (userData) {
            currentUserRole = userData.role || 'staff';
            currentUserId = userData.id;

            if (currentUserRole !== 'admin') {
              hideAdminFeatures();
            }
          }
        })
        .catch(error => {
          console.error('Error checking permissions:', error);
          currentUserRole = 'staff';
          hideAdminFeatures();
        });
    }

    function hideAdminFeatures() {
      const addEmployeeSection = document.querySelector('.lg\\:col-span-1');
      if (addEmployeeSection) {
        addEmployeeSection.style.display = 'none';
      }

      const tableSection = document.querySelector('.lg\\:col-span-2');
      if (tableSection) {
        tableSection.className = tableSection.className.replace('lg:col-span-2', 'lg:col-span-3');
      }
    }

    // Notification system
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      const notificationText = document.getElementById('notificationText');
      const notificationIcon = document.getElementById('notificationIcon');

      notification.className = `notification ${type} px-6 py-4 rounded-lg shadow-lg backdrop-blur-sm`;
      notificationText.textContent = message;

      if (type === 'success') {
        notificationIcon.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22,4 12,14.01 9,11.01"></polyline>
          </svg>
        `;
      } else {
        notificationIcon.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
        `;
      }

      notification.classList.add('show');

      setTimeout(() => {
        notification.classList.remove('show');
      }, 4000);
    }

    // Modal functions
    function openEditModal(employee) {
		document.getElementById('editEmployeeId').value = employee.id;
		document.getElementById('editName').value = employee.name;
		document.getElementById('editEmail').value = employee.email;
		document.getElementById('editPhone').value = employee.phone || '';
		document.getElementById('editPassword').value = '';
		document.getElementById('editRole').value = employee.role;

		document.getElementById('editModal').classList.remove('hidden');
		document.body.style.overflow = 'hidden';
    }

    function closeEditModal() {
		document.getElementById('editModal').classList.add('hidden');
		document.body.style.overflow = 'auto';
    }

    // Load employees function
    async function loadEmployees() {
      try {
        const res = await fetch('/api/employee/list');
        const data = await res.json();
        const tbody = document.getElementById('employeeTableBody');
        const emptyState = document.getElementById('emptyState');
        const employeeCount = document.getElementById('employeeCount');

        tbody.innerHTML = '';
        employeeCount.textContent = data.length;

        if (data.length === 0) {
          emptyState.classList.remove('hidden');
        } else {
          emptyState.classList.add('hidden');

          data.forEach((emp, index) => {
            const row = document.createElement('tr');
            row.className = 'table-row border-b border-gray-100 rounded-lg';
            row.style.animationDelay = `${index * 0.1}s`;
            row.classList.add('animate-fade-in');
            row.innerHTML = `
              <td class="py-3 px-3 text-gray-700 font-medium whitespace-nowrap">#${emp.id}</td>
              <td class="py-3 px-3 whitespace-nowrap">
                <div class="w-8 h-8 rounded-full flex items-center justify-center overflow-hidden">
                  ${emp.profile_photo ?
                    `<img src="${emp.profile_photo}" alt="${emp.name}" class="w-full h-full object-cover rounded-full">` :
                    `<div class="w-full h-full bg-gradient-to-br from-emerald-400 to-teal-500 rounded-full flex items-center justify-center text-white text-xs font-bold">${emp.name.charAt(0).toUpperCase()}</div>`
                  }
                </div>
              </td>
              <td class="py-3 px-3 whitespace-nowrap">
                <span class="font-medium text-gray-900 text-sm">${emp.name}</span>
              </td>
              <td class="py-3 px-3 text-gray-700 text-sm whitespace-nowrap">${emp.email}</td>
              <td class="py-3 px-3 text-gray-500 text-sm whitespace-nowrap">${emp.phone || '<span class="italic">Not provided</span>'}</td>
              <td class="py-3 px-3 whitespace-nowrap">
                <span class="role-badge ${emp.role}">${emp.role}</span>
              </td>
              <td class="py-3 px-3 whitespace-nowrap">
                ${currentUserRole === 'admin' ? `
                <div class="flex space-x-1">
                  <button class="px-2 py-1 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white text-xs font-medium rounded-md shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105 active:scale-95"
                          onclick="openEditModal(${JSON.stringify(emp).replace(/"/g, '&quot;')})">
                    <span class="flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1">
                        <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                        <path d="m15 5 4 4"/>
                      </svg>
                      Edit
                    </span>
                  </button>
                  <button class="px-2 py-1 bg-gradient-to-r ${emp.role === 'admin' ? 'from-gray-400 to-gray-500 cursor-not-allowed' : 'from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600'} text-white text-xs font-medium rounded-md shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105 active:scale-95"
                          onclick="deleteEmployee(${emp.id}, '${emp.role}')"
                          ${emp.role === 'admin' ? 'disabled title="Cannot delete admin users"' : ''}>
                    <span class="flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1">
                        <polyline points="3,6 5,6 21,6"></polyline>
                        <path d="m19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"></path>
                      </svg>
                      Delete
                    </span>
                  </button>
                </div>
                ` : '<span class="text-gray-400 text-xs italic">Admin access required</span>'}
              </td>
            `;

            tbody.appendChild(row);
          });
        }
      } catch (error) {
        console.error('Error loading employees:', error);
        showNotification('Failed to load employees', 'error');
      }
    }

    // Form submission for adding new employee
    document.getElementById('employeeForm').addEventListener('submit', async e => {
      e.preventDefault();

      const formData = new FormData(e.target);
      const submitButton = e.target.querySelector('button[type="submit"]');
      const photoFile = document.getElementById('profilePhoto').files[0];

      submitButton.disabled = true;
      submitButton.innerHTML = `
        <span class="flex items-center justify-center">
          <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Adding Employee...
        </span>
      `;

      try {
        if (photoFile) {
          try {
            const photoUrl = await uploadPhoto(photoFile);
            formData.append('profile_photo_url', photoUrl);
          } catch (photoError) {
            showNotification('Failed to upload photo. Employee will be created without profile photo.', 'error');
          }
        }

        const res = await fetch('/api/employee/create', {
          method: 'POST',
          body: formData
        });
        const result = await res.json();

        if (res.ok) {
          showNotification('✅ Employee added successfully!', 'success');
          e.target.reset();
          document.getElementById('photoPreview').innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/>
              <circle cx="12" cy="13" r="3"/>
            </svg>
          `;
          loadEmployees();
        } else {
          showNotification('❌ Error: ' + (result.error || 'Unknown error occurred'), 'error');
        }
      } catch (error) {
        console.error('Error creating employee:', error);
        showNotification('❌ Network error occurred', 'error');
      } finally {
        submitButton.disabled = false;
        submitButton.innerHTML = `
          <span class="flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Add Employee
          </span>
        `;
      }
    });

    // Form submission for editing employee
    document.getElementById('editEmployeeForm').addEventListener('submit', async e => {
      e.preventDefault();

      const formData = new FormData(e.target);
      const employeeId = document.getElementById('editEmployeeId').value;
      const submitButton = e.target.querySelector('button[type="submit"]');
      const photoFile = document.getElementById('editProfilePhoto');

      submitButton.disabled = true;
      submitButton.innerHTML = `
        <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Updating...
      `;

      try {
        if (photoFile) {
          try {
            const photoUrl = await uploadPhoto(photoFile.files[0]);
            formData.append('profile_photo_url', photoUrl);
          } catch (photoError) {
            showNotification('Failed to upload photo. Employee will be updated without new profile photo.', 'error');
          }
        }

        const res = await fetch(`/api/employee/update/${employeeId}`, {
          method: 'PUT',
          body: formData
        });
        const result = await res.json();

        if (res.ok) {
          showNotification('✅ Employee updated successfully!', 'success');
          closeEditModal();
          loadEmployees();
        } else {
          showNotification('❌ Error: ' + (result.error || 'Unknown error occurred'), 'error');
        }
      } catch (error) {
        console.error('Error updating employee:', error);
        showNotification('❌ Network error occurred', 'error');
      } finally {
        submitButton.disabled = false;
        submitButton.innerHTML = 'Update Employee';
      }
    });

    // Delete employee function with admin protection
    async function deleteEmployee(id, role) {
      if (currentUserRole !== 'admin') {
        showNotification('Access denied. Admin privileges required.', 'error');
        return;
      }

      if (role === 'admin') {
        showNotification('Cannot delete admin users. Please change role to staff first.', 'error');
        return;
      }

      if (!confirm("Are you sure you want to delete this employee? This action cannot be undone.")) return;

      try {
        const res = await fetch(`/api/employee/delete/${id}`, { method: 'DELETE' });
        const result = await res.json();

        if (res.ok) {
          showNotification('Employee deleted successfully', 'success');
          loadEmployees();
        } else {
          showNotification(result.error || 'Failed to delete employee', 'error');
        }
      } catch (error) {
        console.error('Error deleting employee:', error);
        showNotification('Network error occurred', 'error');
      }
    }

    // Close modal when clicking outside
    document.getElementById('editModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeEditModal();
      }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && !document.getElementById('editModal').classList.contains('hidden')) {
        closeEditModal();
      }
    });

    // Load employees on page load
    document.addEventListener('DOMContentLoaded', function() {
      checkUserPermissions();
      loadEmployees();
      initializeVisitorSearch();
    });
  </script>
</body>
</html>