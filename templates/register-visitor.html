<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <title>Register Visitor</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <script src="https://cdn.tailwindcss.com"></script>
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.9/jquery.inputmask.min.js"></script>
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
      <style>
         :root {
           --item-white: #FFFFFF;
           --item-black: #000000;
           --item-purple: #6B46C1;
           --item-orange: #F97316;
           --item-lavender: #E6E6FA;
           --item-lilac: #C8A2C8;
           --item-orchid: #DA70D6;
           --item-iris: #5D3FD3;
           --item-violet: #8A2BE2;
           --item-indigo: #4B0082;
           --item-mist: #F2F2F2;
           --item-dove: #E6E6E6;
           --item-steel: #CCCCCC;
           --item-glacier: #999999;
           --item-slate: #808080;
           --item-iron: #666666;
           --item-shadow: #4D4D4D;
         }

         * {
           font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
         }

         body {
           background: linear-gradient(135deg, var(--item-white) 0%, var(--item-mist) 50%, var(--item-dove) 100%);
           color: var(--item-shadow);
         }

         @keyframes slide-down {
         from {
         opacity: 0;
         transform: translateY(-20px);
         }
         to {
         opacity: 1;
         transform: translateY(0);
         }
         }
         @keyframes fade-in {
         from {
         opacity: 0;
         transform: translateY(10px);
         }
         to {
         opacity: 1;
         transform: translateY(0);
         }
         }
         @keyframes success-bounce {
         0%, 20%, 50%, 80%, 100% {
         transform: translateY(0);
         }
         40% {
         transform: translateY(-10px);
         }
         60% {
         transform: translateY(-5px);
         }
         }
         .animate-slide-down {
         animation: slide-down 0.6s ease-out;
         }
         .animate-fade-in {
         animation: fade-in 0.4s ease-out;
         }
         .animate-success-bounce {
         animation: success-bounce 2s infinite;
         }
         .notification {
         position: fixed;
         top: 20px;
         right: 20px;
         z-index: 1000;
         transform: translateX(400px);
         opacity: 0;
         transition: all 0.3s ease;
         border-radius: 12px;
         border: 1px solid var(--item-dove);
         }
         .notification.show {
         transform: translateX(0);
         opacity: 1;
         }
         .notification.success {
         background: var(--item-white);
         color: var(--item-purple);
         border-color: var(--item-purple);
         box-shadow: 0 4px 20px rgba(107, 70, 193, 0.15);
         }
         .notification.error {
         background: var(--item-white);
         color: var(--item-orange);
         border-color: var(--item-orange);
         box-shadow: 0 4px 20px rgba(249, 115, 22, 0.15);
         }
         .file-upload-area {
         border: 2px dashed var(--item-steel);
         border-radius: 12px;
         padding: 24px;
         text-align: center;
         transition: all 0.3s ease;
         background: var(--item-white);
         cursor: pointer;
         }
         .file-upload-area:hover {
         border-color: var(--item-purple);
         background: var(--item-lavender);
         }
         .file-upload-area.drag-over {
         border-color: var(--item-purple);
         background: var(--item-lavender);
         }
         .preview-container {
         max-width: 220px;
         margin: 16px auto;
         border-radius: 12px;
         overflow: hidden;
         box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
         }
         .success-result {
         background: var(--item-white);
         border: 2px solid var(--item-purple);
         box-shadow: 0 4px 20px rgba(107, 70, 193, 0.1);
         }
         .error-result {
         background: var(--item-white);
         border: 2px solid var(--item-orange);
         box-shadow: 0 4px 20px rgba(249, 115, 22, 0.1);
         }
         .qr-preview {
         max-width: 200px;
         margin: 16px auto;
         display: block;
         border-radius: 12px;
         box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
         }

         .item-card {
           background: var(--item-white);
           border: 1px solid var(--item-dove);
           border-radius: 16px;
           box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
           transition: all 0.3s ease;
         }

         .item-card:hover {
           box-shadow: 0 8px 40px rgba(0, 0, 0, 0.08);
           transform: translateY(-2px);
         }

         .item-input {
           background: var(--item-white);
           border: 1px solid var(--item-steel);
           border-radius: 8px;
           padding: 12px 16px;
           transition: all 0.2s ease;
           font-weight: 400;
           color: var(--item-shadow);
         }

         .item-input:focus {
           outline: none;
           border-color: var(--item-purple);
           box-shadow: 0 0 0 3px rgba(107, 70, 193, 0.1);
         }

         .item-input::placeholder {
           color: var(--item-glacier);
         }

         .item-button-primary {
           background: var(--item-purple);
           color: var(--item-white);
           border: none;
           border-radius: 8px;
           padding: 16px 24px;
           font-weight: 600;
           transition: all 0.2s ease;
           cursor: pointer;
         }

         .item-button-primary:hover {
           background: var(--item-iris);
           transform: translateY(-1px);
           box-shadow: 0 4px 20px rgba(107, 70, 193, 0.3);
         }

         .item-button-primary:active {
           transform: translateY(0);
         }

         .item-button-secondary {
           background: var(--item-white);
           color: var(--item-purple);
           border: 1px solid var(--item-purple);
           border-radius: 8px;
           padding: 12px 16px;
           font-weight: 500;
           transition: all 0.2s ease;
           cursor: pointer;
         }

         .item-button-secondary:hover {
           background: var(--item-lavender);
         }

         .section-card {
           background: var(--item-white);
           border-radius: 12px;
           padding: 24px;
           margin-bottom: 20px;
           border: 1px solid var(--item-dove);
         }

         .section-title {
           font-size: 18px;
           font-weight: 600;
           color: var(--item-shadow);
           margin-bottom: 16px;
           display: flex;
           align-items: center;
         }

         .label-text {
           font-size: 14px;
           font-weight: 500;
           color: var(--item-iron);
           margin-bottom: 6px;
           display: flex;
           align-items: center;
         }

         .icon-purple { color: var(--item-purple); }
         .icon-orange { color: var(--item-orange); }
         .icon-iris { color: var(--item-iris); }
         .icon-violet { color: var(--item-violet); }
      </style>
   </head>
   <body class="min-h-screen">
      <!-- Notification System -->
      <div id="notification" class="notification px-6 py-4 backdrop-blur-sm">
         <div class="flex items-center">
            <div id="notificationIcon" class="mr-3"></div>
            <span id="notificationText"></span>
         </div>
      </div>

      <div class="container mx-auto px-4 py-8 max-w-7xl">
         <!-- Header Section -->
         <div class="mb-8 transform animate-slide-down">
            <div class="item-card overflow-hidden">
               <header class="relative px-8 py-8" style="background: linear-gradient(135deg, var(--item-purple) 0%, var(--item-iris) 100%);">
                  <!-- Decorative Elements -->
                  <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"></div>
                  <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full translate-y-12 -translate-x-12"></div>
                  <div class="relative flex items-center text-white">
                     <div class="flex items-center">
                        <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center mr-6 backdrop-blur-sm">
                           <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                              <circle cx="9" cy="7" r="4"></circle>
                              <line x1="22" y1="11" x2="16" y2="11"></line>
                              <line x1="19" y1="8" x2="19" y2="14"></line>
                           </svg>
                        </div>
                        <div>
                           <h1 class="text-4xl font-bold tracking-tight mb-2">Register Visitor</h1>
                           <p class="text-white/80 text-lg font-medium">Create a new visitor registration with QR code access</p>
                        </div>
                     </div>
                  </div>
               </header>
            </div>
         </div>

         <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Registration Form -->
            <div class="lg:col-span-2 transform animate-fade-in">
               <div class="item-card overflow-hidden">
                  <div class="px-6 py-4" style="background: linear-gradient(135deg, var(--item-shadow) 0%, var(--item-iron) 100%);">
                     <h2 class="text-xl font-semibold flex items-center text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3">
                           <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                           <polyline points="14,2 14,8 20,8"></polyline>
                           <line x1="16" y1="13" x2="8" y2="13"></line>
                           <line x1="16" y1="17" x2="8" y2="17"></line>
                        </svg>
                        Visitor Information
                     </h2>
                  </div>
                  <div class="p-8">
                     <form id="visitorForm" class="space-y-6" enctype="multipart/form-data">
                        <!-- Personal Information Section -->
                        <div class="section-card">
                           <h3 class="section-title">
                              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3 icon-purple">
                                 <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                                 <circle cx="12" cy="7" r="4"></circle>
                              </svg>
                              Personal Information
                           </h3>
                           <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                              <!-- Full Name -->
                              <div class="space-y-2">
                                 <label class="label-text">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 icon-purple">
                                       <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                                       <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                    Full Name *
                                 </label>
                                 <input type="text" name="name" required
                                    placeholder="Enter visitor's full name"
                                    class="item-input w-full">
                              </div>
                              <!-- Phone Number -->
                              <div class="space-y-2">
                                 <label class="label-text">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 icon-iris">
                                       <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                    </svg>
                                    Phone Number
                                 </label>
                                 <input type="text" name="phone"
                                    placeholder="+1 (555) 123-4567"
                                    class="item-input w-full">
                              </div>
                              <!-- Email Address -->
                              <div class="space-y-2 md:col-span-2">
                                 <label class="label-text">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 icon-violet">
                                       <path d="m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7"></path>
                                       <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                                    </svg>
                                    Email Address
                                 </label>
                                 <input type="email" name="email"
                                    placeholder="visitor@example.com"
                                    class="item-input w-full">
                              </div>
                           </div>
                        </div>

                        <!-- Visit Details Section -->
                        <div class="section-card">
                           <h3 class="section-title">
                              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3 icon-orange">
                                 <path d="M8 2v4"></path>
                                 <path d="M16 2v4"></path>
                                 <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                                 <path d="M3 10h18"></path>
                              </svg>
                              Visit Details
                           </h3>
                           <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                              <!-- Visit Date & Time -->
                              <div class="space-y-2">
                                 <label class="label-text">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 icon-orange">
                                       <path d="M8 2v4"></path>
                                       <path d="M16 2v4"></path>
                                       <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                                       <path d="M3 10h18"></path>
                                    </svg>
                                    Visit Date & Time *
                                 </label>
                                 <input type="datetime-local" name="visit_date" required
                                    class="item-input w-full">
                              </div>
                              <!-- Estimated Time -->
                              <div class="space-y-2">
                                 <label class="label-text">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 icon-iris">
                                       <circle cx="12" cy="12" r="10"></circle>
                                       <polyline points="12,6 12,12 16,14"></polyline>
                                    </svg>
                                    Estimated Time *
                                 </label>
                                 <input type="text" id="estimate_time" name="estimate_time" required
                                    placeholder="HH:mm:ss"
                                    pattern="^([01]\d|2[0-3]):[0-5]\d:[0-5]\d$"
                                    title="Please enter time in HH:mm:ss format (e.g. 14:30:00)"
                                    class="item-input w-full">
                              </div>
                              <!-- Host Employee -->
                              <div class="space-y-2">
                                 <label class="label-text">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 icon-violet">
                                       <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                       <circle cx="9" cy="7" r="4"></circle>
                                       <path d="m22 21-3-3"></path>
                                    </svg>
                                    Host Employee ID *
								  </label>
								  <input type="hidden" name="host_employee" id="hostEmployeeHidden">
								  <div id="hostEmployeeLabel" class="item-input w-full bg-gray-50 text-gray-700"></div>
                              </div>
                              <!-- Visit Location -->
                              <div class="space-y-2">
                                 <label class="label-text">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 icon-purple">
                                       <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
                                       <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                    Visit Location *
                                 </label>
                                 <select name="location_id" id="locationSelect" required
                                    class="item-input w-full">
                                    <option value="">-- Select Location --</option>
                                 </select>
                              </div>
                           </div>
                        </div>

                        <!-- File Uploads Section -->
                        <div class="section-card">
                           <h3 class="section-title">
                              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3 icon-violet">
                                 <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                 <polyline points="14,2 14,8 20,8"></polyline>
                                 <line x1="16" y1="13" x2="8" y2="13"></line>
                                 <line x1="16" y1="17" x2="8" y2="17"></line>
                              </svg>
                              Documents & Photos
                           </h3>
                           <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                              <!-- Photo Upload -->
                              <div class="space-y-2">
                                 <label class="label-text">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 icon-purple">
                                       <rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect>
                                       <circle cx="9" cy="9" r="2"></circle>
                                       <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path>
                                    </svg>
                                    Photo Upload
                                 </label>
                                 <div class="file-upload-area" onclick="document.getElementById('photoInput').click()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-2" style="color: var(--item-glacier)">
                                       <rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect>
                                       <circle cx="9" cy="9" r="2"></circle>
                                       <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path>
                                    </svg>
                                    <p class="font-medium" style="color: var(--item-iron)">Click to upload photo</p>
                                    <p class="text-sm" style="color: var(--item-glacier)">PNG, JPG up to 10MB</p>
                                 </div>
                                 <input type="file" name="photo" accept="image/*" class="hidden" id="photoInput">
                                 <img id="photoPreview" class="preview-container hidden w-full h-auto" alt="Photo preview">
                              </div>
                              <!-- Document Upload -->
                              <div class="space-y-2">
                                 <label class="label-text">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 icon-orange">
                                       <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                       <polyline points="14,2 14,8 20,8"></polyline>
                                       <line x1="16" y1="13" x2="8" y2="13"></line>
                                       <line x1="16" y1="17" x2="8" y2="17"></line>
                                    </svg>
                                    Document Upload (ID, License)
                                 </label>
                                 <div class="file-upload-area" onclick="document.getElementById('docInput').click()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-2" style="color: var(--item-glacier)">
                                       <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                       <polyline points="14,2 14,8 20,8"></polyline>
                                       <line x1="16" y1="13" x2="8" y2="13"></line>
                                       <line x1="16" y1="17" x2="8" y2="17"></line>
                                    </svg>
                                    <p class="font-medium" style="color: var(--item-iron)">Click to upload document</p>
                                    <p class="text-sm" style="color: var(--item-glacier)">ID, License, PDF up to 10MB</p>
                                 </div>
                                 <input type="file" name="document" accept="image/*,.pdf" class="hidden" id="docInput">
                                 <img id="docPreview" class="preview-container hidden w-full h-auto" alt="Document preview">
                              </div>
                           </div>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="item-button-primary w-full text-lg">
                           <span class="flex items-center justify-center">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3">
                                 <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                 <circle cx="9" cy="7" r="4"></circle>
                                 <line x1="22" y1="11" x2="16" y2="11"></line>
                                 <line x1="19" y1="8" x2="19" y2="14"></line>
                              </svg>
                              Register Visitor
                           </span>
                        </button>
                     </form>
                  </div>
               </div>
            </div>

            <!-- Result Panel -->
            <div class="lg:col-span-1 transform animate-fade-in" style="animation-delay: 0.2s;">
               <div class="item-card overflow-hidden sticky top-8">
                  <div class="px-6 py-4" style="background: linear-gradient(135deg, var(--item-violet) 0%, var(--item-indigo) 100%);">
                     <h2 class="text-xl font-semibold flex items-center text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3">
                           <rect width="5" height="5" x="3" y="3" rx="1"></rect>
                           <rect width="5" height="5" x="16" y="3" rx="1"></rect>
                           <rect width="5" height="5" x="3" y="16" rx="1"></rect>
                           <path d="M21 16h-3a2 2 0 0 0-2 2v3"></path>
                           <path d="M21 21v.01"></path>
                           <path d="M12 7v3a2 2 0 0 1-2 2H7"></path>
                           <path d="M3 12h.01"></path>
                           <path d="M12 3h.01"></path>
                           <path d="M12 16v.01"></path>
                           <path d="M16 12h1"></path>
                           <path d="M21 12v.01"></path>
                           <path d="M12 21v-1"></path>
                        </svg>
                        Registration Result
                     </h2>
                  </div>
                  <div class="p-6">
                     <div id="result" class="text-center">
                        <div class="w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4" style="background: linear-gradient(135deg, var(--item-mist) 0%, var(--item-dove) 100%);">
                           <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="color: var(--item-glacier)">
                              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                              <circle cx="9" cy="7" r="4"></circle>
                              <line x1="22" y1="11" x2="16" y2="11"></line>
                              <line x1="19" y1="8" x2="19" y2="14"></line>
                           </svg>
                        </div>
                        <h3 class="text-lg font-semibold mb-2" style="color: var(--item-shadow)">Ready to Register</h3>
                        <p style="color: var(--item-glacier)">Fill out the form to create a new visitor registration with QR code access.</p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <script>
         // Notification system
         function showNotification(message, type = 'success') {
           const notification = document.getElementById('notification');
           const notificationText = document.getElementById('notificationText');
           const notificationIcon = document.getElementById('notificationIcon');

           notification.className = `notification ${type} px-6 py-4 backdrop-blur-sm`;
           notificationText.textContent = message;

           if (type === 'success') {
             notificationIcon.innerHTML = `
               <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--item-purple)">
                 <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                 <polyline points="22,4 12,14.01 9,11.01"/>
               </svg>
             `;
           } else {
             notificationIcon.innerHTML = `
               <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--item-orange)">
                 <circle cx="12" cy="12" r="10"/>
                 <line x1="15" y1="9" x2="9" y2="15"/>
                 <line x1="9" y1="9" x2="15" y2="15"/>
               </svg>
             `;
           }

           notification.classList.add('show');

           setTimeout(() => {
             notification.classList.remove('show');
           }, 4000);
         }

         // Load employees and locations into dropdowns
         document.addEventListener('DOMContentLoaded', async () => {
			const hostLabel = document.getElementById('hostEmployeeLabel');
			const hostHidden = document.getElementById('hostEmployeeHidden');
			const locationSelect = document.getElementById('locationSelect');

			try {
				//Load employees
				const currentUser = await fetch('/api/user/session').then(r => r.json());
				hostLabel.textContent = `${currentUser.name} (${currentUser.email})`;
				hostHidden.value = currentUser.id;

				//Load locations
				const locRes = await fetch('/api/location/list');
				const locations = await locRes.json();
				for (const loc of locations) {
					const opt = document.createElement('option');
					opt.value = loc.id;
					opt.textContent = loc.name;
					locationSelect.appendChild(opt);
				}
            } catch (err) {
				 console.error('Failed to load employees/locations:', err);
				 showNotification('Failed to load form data', 'error');
			}

            // Initialize input mask for time
            $('#estimate_time').inputmask({
              mask: "99:99:99",
              placeholder: "hh:mm:ss",
              showMaskOnHover: false,
              showMaskOnFocus: true,
              definitions: {
                '9': {
                  validator: "[0-9]",
                  cardinality: 1
                }
              },
              onBeforePaste: function (pastedValue, opts) {
                return pastedValue.replace(/[^0-9:]/g, '');
              },
              isComplete: function(buffer, opts) {
                const value = buffer.join('');
                const parts = value.split(':');
                if (parts.length !== 3) return false;

                const hours = parseInt(parts[0], 10);
                const minutes = parseInt(parts[1], 10);
                const seconds = parseInt(parts[2], 10);

                return hours >= 0 && hours <= 23 &&
                       minutes >= 0 && minutes <= 59 &&
                       seconds >= 0 && seconds <= 59;
              }
            });
         });

         // Image preview functionality
         function previewImage(inputElement, previewElementId) {
           const file = inputElement.files[0];
           if (file && file.type.startsWith('image/')) {
             const reader = new FileReader();
             reader.onload = function(e) {
               const preview = document.getElementById(previewElementId);
               preview.src = e.target.result;
               preview.style.display = 'block';
               preview.classList.remove('hidden');
             };
             reader.readAsDataURL(file);
           }
         }

         document.getElementById('photoInput').addEventListener('change', function () {
           previewImage(this, 'photoPreview');
         });

         document.getElementById('docInput').addEventListener('change', function () {
           previewImage(this, 'docPreview');
         });

         function reset(){
               form.reset();
               document.getElementById('photoPreview').style.display = 'none';
               document.getElementById('photoPreview').classList.add('hidden');
               document.getElementById('docPreview').style.display = 'none';
               document.getElementById('docPreview').classList.add('hidden');
         }

         // Handle form submission
         document.getElementById('visitorForm').addEventListener('submit', async function(e) {
           e.preventDefault();

           const form = e.target;
           const formData = new FormData(form);
           const submitButton = form.querySelector('button[type="submit"]');
           const resultDiv = document.getElementById('result');

           // Show loading state
           submitButton.disabled = true;
           submitButton.innerHTML = `
             <span class="flex items-center justify-center">
               <svg class="animate-spin -ml-1 mr-3 h-6 w-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                 <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                 <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
               </svg>
               Processing...
             </span>
           `;

           try {
             const res = await fetch('/api/visitor/create', {
               method: 'POST',
               body: formData
             });

             const result = await res.json();

             if (res.ok) {
               // Success result
               resultDiv.innerHTML = `
                 <div class="success-result rounded-2xl p-6">
                   <div class="w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 animate-success-bounce" style="background: var(--item-purple)">
                     <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                       <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                       <polyline points="22,4 12,14.01 9,11.01"/>
                     </svg>
                   </div>
                   <h3 class="text-lg font-semibold mb-2" style="color: var(--item-purple)">‚úÖ Visitor created</h3>
                   <p class="text-sm mb-4" style="color: var(--item-iron)">Registration completed successfully.</p>

                   <div class="bg-white/80 rounded-lg p-4 mb-4 border" style="border-color: var(--item-dove)">
                     <div class="text-sm mb-2" style="color: var(--item-iron)">
                       <strong>Token:</strong> <code class="px-2 py-1 rounded" style="background: var(--item-lavender); color: var(--item-purple)">${result.token}</code>
                     </div>
                     <img class="qr-preview mx-auto" src="${result.qr_code_url}" alt="QR Code" />
                     <a href="${result.qr_code_url}" download class="item-button-secondary inline-flex items-center justify-center w-full mt-3">
                       <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                         <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                         <polyline points="7,10 12,15 17,10"/>
                         <line x1="12" y1="15" x2="12" y2="3"/>
                       </svg>
                       Download QR Code
                     </a>
                   </div>

                   <div class="grid grid-cols-2 gap-2">
                     <button id="sendEmailBtn" title="Send by Email" class="item-button-secondary flex items-center justify-center">
                       üìß Email
                     </button>
                     <button id="sendSmsBtn" title="Send by SMS" class="item-button-secondary flex items-center justify-center">
                       üì± SMS
                     </button>
                   </div>
                 </div>
               `;

               // Smooth scroll to result
               setTimeout(() => {
                 window.scrollTo({
                   top: document.body.scrollHeight,
                   behavior: 'smooth'
                 });
               }, 100);

               // Add event listeners for email and SMS buttons
               document.getElementById('sendEmailBtn').addEventListener('click', async () => {
                 const button = document.getElementById('sendEmailBtn');
                 const originalHTML = button.innerHTML;

                 button.disabled = true;
                 button.innerHTML = '<span class="animate-spin">‚è≥</span> Sending...';

                 try {
                   const res = await fetch('/api/visitor/send_email', {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify(result)
                   });
                   const r = await res.json();

                   if (res.ok) {
                     showNotification('Email sent successfully!', 'success');
                   } else {
                     showNotification(r.message || 'Failed to send email', 'error');
                   }
                 } catch (error) {
                   showNotification('Failed to send email', 'error');
                 } finally {
                   button.disabled = false;
                   button.innerHTML = originalHTML;
                 }
               });

               document.getElementById('sendSmsBtn').addEventListener('click', async () => {
                 const button = document.getElementById('sendSmsBtn');
                 const originalHTML = button.innerHTML;

                 button.disabled = true;
                 button.innerHTML = '<span class="animate-spin">‚è≥</span> Sending...';

                 try {
                   const res = await fetch('/api/visitor/send_sms', {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify(result)
                   });
                   const r = await res.json();

                   if (res.ok) {
                     showNotification('SMS sent successfully!', 'success');
                   } else {
                     showNotification(r.message || 'Failed to send SMS', 'error');
                   }
                 } catch (error) {
                   showNotification('Failed to send SMS', 'error');
                 } finally {
                   button.disabled = false;
                   button.innerHTML = originalHTML;
                 }
               });

               showNotification('Visitor registered successfully!', 'success');

             } else {
               // Error result
               resultDiv.innerHTML = `
                 <div class="error-result rounded-2xl p-6">
                   <div class="w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4" style="background: var(--item-orange)">
                     <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                       <circle cx="12" cy="12" r="10"/>
                       <line x1="15" y1="9" x2="9" y2="15"/>
                       <line x1="9" y1="9" x2="15" y2="15"/>
                     </svg>
                   </div>
                   <h3 class="text-lg font-semibold mb-2" style="color: var(--item-orange)">‚ùå Error</h3>
                   <p class="text-sm" style="color: var(--item-iron)">${result.error || 'Unknown error'}</p>
                 </div>
               `;
               showNotification(result.error || 'Registration failed', 'error');
             }
           } catch (error) {
             console.error('Error submitting form:', error);
             resultDiv.innerHTML = `
               <div class="error-result rounded-2xl p-6">
                 <div class="w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4" style="background: var(--item-orange)">
                   <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                     <circle cx="12" cy="12" r="10"/>
                     <line x1="15" y1="9" x2="9" y2="15"/>
                     <line x1="9" y1="9" x2="15" y2="15"/>
                   </svg>
                 </div>
                 <h3 class="text-lg font-semibold mb-2" style="color: var(--item-orange)">‚ùå Network Error</h3>
                 <p class="text-sm" style="color: var(--item-iron)">Failed to connect to the server. Please try again.</p>
               </div>
             `;
             showNotification('Network error occurred', 'error');
           } finally {
             // Restore button state
             submitButton.disabled = false;
             submitButton.innerHTML = `
               <span class="flex items-center justify-center">
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3">
                   <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                   <circle cx="9" cy="7" r="4"></circle>
                   <line x1="22" y1="11" x2="16" y2="11"></line>
                   <line x1="19" y1="8" x2="19" y2="14"></line>
                 </svg>
                 Register Visitor
               </span>
             `;
           }
         });
      </script>
   </body>
</html>