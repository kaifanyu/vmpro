<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <title>Register Visitor</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <script src="https://cdn.tailwindcss.com"></script>
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.9/jquery.inputmask.min.js"></script>
      <style>
         @keyframes slide-down {
         from {
         opacity: 0;
         transform: translateY(-20px);
         }
         to {
         opacity: 1;
         transform: translateY(0);
         }
         }
         @keyframes fade-in {
         from {
         opacity: 0;
         transform: translateY(10px);
         }
         to {
         opacity: 1;
         transform: translateY(0);
         }
         }
         @keyframes success-bounce {
         0%, 20%, 50%, 80%, 100% {
         transform: translateY(0);
         }
         40% {
         transform: translateY(-10px);
         }
         60% {
         transform: translateY(-5px);
         }
         }
         .animate-slide-down {
         animation: slide-down 0.6s ease-out;
         }
         .animate-fade-in {
         animation: fade-in 0.4s ease-out;
         }
         .animate-success-bounce {
         animation: success-bounce 2s infinite;
         }
         .notification {
         position: fixed;
         top: 20px;
         right: 20px;
         z-index: 1000;
         transform: translateX(400px);
         opacity: 0;
         transition: all 0.3s ease;
         }
         .notification.show {
         transform: translateX(0);
         opacity: 1;
         }
         .notification.success {
         background: linear-gradient(135deg, #10b981, #059669);
         color: white;
         }
         .notification.error {
         background: linear-gradient(135deg, #ef4444, #dc2626);
         color: white;
         }
         .file-upload-area {
         border: 2px dashed #d1d5db;
         border-radius: 12px;
         padding: 20px;
         text-align: center;
         transition: all 0.3s ease;
         background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(16, 185, 129, 0.05));
         cursor: pointer;
         }
         .file-upload-area:hover {
         border-color: #3b82f6;
         background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
         }
         .file-upload-area.drag-over {
         border-color: #10b981;
         background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(59, 130, 246, 0.15));
         }
         .preview-container {
         max-width: 220px;
         margin: 16px auto;
         border-radius: 12px;
         overflow: hidden;
         box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
         }
         .success-result {
         background: linear-gradient(135deg, #ecfdf5, #d1fae5);
         border: 2px solid #10b981;
         }
         .error-result {
         background: linear-gradient(135deg, #fef2f2, #fecaca);
         border: 2px solid #ef4444;
         }
         .qr-preview {
         max-width: 200px;
         margin: 16px auto;
         display: block;
         border-radius: 12px;
         box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
         }
      </style>
   </head>
   <body class="min-h-screen bg-gradient-to-br from-emerald-50 via-blue-50 to-teal-100">
      <!-- Notification System -->
      <div id="notification" class="notification px-6 py-4 rounded-lg shadow-lg backdrop-blur-sm">
         <div class="flex items-center">
            <div id="notificationIcon" class="mr-3"></div>
            <span id="notificationText"></span>
         </div>
      </div>
      <div class="container mx-auto px-4 py-8">
         <!-- Header Section -->
         <div class="mb-8 transform animate-slide-down">
            <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 overflow-hidden">
               <header class="relative px-8 py-6 bg-gradient-to-r from-emerald-600 to-teal-700 text-white">
                  <!-- Decorative Elements -->
                  <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"></div>
                  <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full translate-y-12 -translate-x-12"></div>
                  <div class="relative flex items-center">
                     <div class="flex items-center">
                        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mr-4">
                           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                              <circle cx="9" cy="7" r="4"></circle>
                              <line x1="22" y1="11" x2="16" y2="11"></line>
                              <line x1="19" y1="8" x2="19" y2="14"></line>
                           </svg>
                        </div>
                        <div>
                           <h1 class="text-3xl font-bold tracking-tight">Register Visitor</h1>
                           <p class="text-emerald-100 mt-1">Create a new visitor registration with QR code</p>
                        </div>
                     </div>
                  </div>
               </header>
            </div>
         </div>
         <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Registration Form -->
            <div class="lg:col-span-2 transform animate-fade-in">
               <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 overflow-hidden">
                  <div class="px-6 py-4 bg-gradient-to-r from-blue-500 to-indigo-600 text-white">
                     <h2 class="text-xl font-semibold flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                           <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                           <polyline points="14,2 14,8 20,8"></polyline>
                           <line x1="16" y1="13" x2="8" y2="13"></line>
                           <line x1="16" y1="17" x2="8" y2="17"></line>
                        </svg>
                        Visitor Information
                     </h2>
                  </div>
                  <div class="p-8">
                     <form id="visitorForm" class="space-y-6" enctype="multipart/form-data">
                        <!-- Personal Information Section -->
                        <div class="bg-gradient-to-br from-gray-50 to-white rounded-2xl p-6 shadow-inner border border-gray-100">
                           <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-emerald-600">
                                 <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                                 <circle cx="12" cy="7" r="4"></circle>
                              </svg>
                              Personal Information
                           </h3>
                           <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <!-- Full Name -->
                              <div class="space-y-2">
                                 <label class="text-sm font-medium text-gray-700 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-emerald-500">
                                       <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                                       <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                    Full Name *
                                 </label>
                                 <input type="text" name="name" required
                                    placeholder="Enter visitor's full name"
                                    class="w-full px-4 py-3 bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200">
                              </div>
                              <!-- Phone Number -->
                              <div class="space-y-2">
                                 <label class="text-sm font-medium text-gray-700 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-purple-500">
                                       <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                    </svg>
                                    Phone Number
                                 </label>
                                 <input type="text" name="phone"
                                    placeholder="+1 (555) 123-4567"
                                    class="w-full px-4 py-3 bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200">
                              </div>
                              <!-- Email Address -->
                              <div class="space-y-2 md:col-span-2">
                                 <label class="text-sm font-medium text-gray-700 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-blue-500">
                                       <path d="m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7"></path>
                                       <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                                    </svg>
                                    Email Address
                                 </label>
                                 <input type="email" name="email"
                                    placeholder="visitor@example.com"
                                    class="w-full px-4 py-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                              </div>
                           </div>
                        </div>
                        <!-- Visit Details Section -->
                        <div class="bg-gradient-to-br from-gray-50 to-white rounded-2xl p-6 shadow-inner border border-gray-100">
                           <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-orange-600">
                                 <path d="M8 2v4"></path>
                                 <path d="M16 2v4"></path>
                                 <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                                 <path d="M3 10h18"></path>
                              </svg>
                              Visit Details
                           </h3>
                           <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <!-- Visit Date & Time -->
                              <div class="space-y-2">
                                 <label class="text-sm font-medium text-gray-700 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-orange-500">
                                       <path d="M8 2v4"></path>
                                       <path d="M16 2v4"></path>
                                       <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                                       <path d="M3 10h18"></path>
                                    </svg>
                                    Visit Date & Time *
                                 </label>
                                 <input type="datetime-local" name="visit_date" required
                                    class="w-full px-4 py-3 bg-gradient-to-r from-orange-50 to-yellow-50 border border-orange-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200">
                              </div>
                              <!-- Estimated Time -->
                              <div class="space-y-2">
                                 <label class="text-sm font-medium text-gray-700 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-indigo-500">
                                       <circle cx="12" cy="12" r="10"></circle>
                                       <polyline points="12,6 12,12 16,14"></polyline>
                                    </svg>
                                    Estimated Time *
                                 </label>
                                 <input type="text" id="estimate_time" name="estimate_time" required
                                    placeholder="HH:mm:ss"
                                    pattern="^([01]\d|2[0-3]):[0-5]\d:[0-5]\d$"
                                    title="Please enter time in HH:mm:ss format (e.g. 14:30:00)"
                                    class="w-full px-4 py-3 bg-gradient-to-r from-indigo-50 to-blue-50 border border-indigo-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200">
                              </div>
                              <!-- Host Employee -->
                              <div class="space-y-2">
                                 <label class="text-sm font-medium text-gray-700 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-teal-500">
                                       <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                       <circle cx="9" cy="7" r="4"></circle>
                                       <path d="m22 21-3-3"></path>
                                    </svg>
                                    Host Employee ID *
								  </label>
								  <input type="hidden" name="host_employee" id="hostEmployeeHidden">
								  <div id="hostEmployeeLabel" class="px-4 py-3 bg-gradient-to-r from-teal-50 to-emerald-50 border border-teal-200 rounded-xl text-gray-700"></div>

                              </div>
                              <!-- Visit Location -->
                              <div class="space-y-2">
                                 <label class="text-sm font-medium text-gray-700 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-pink-500">
                                       <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
                                       <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                    Visit Location *
                                 </label>
                                 <select name="location_id" id="locationSelect" required
                                    class="w-full px-4 py-3 bg-gradient-to-r from-pink-50 to-rose-50 border border-pink-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200">
                                    <option value="">-- Select Location --</option>
                                 </select>
                              </div>
                           </div>
                        </div>
                        <!-- File Uploads Section -->
                        <div class="bg-gradient-to-br from-gray-50 to-white rounded-2xl p-6 shadow-inner border border-gray-100">
                           <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-purple-600">
                                 <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                 <polyline points="14,2 14,8 20,8"></polyline>
                                 <line x1="16" y1="13" x2="8" y2="13"></line>
                                 <line x1="16" y1="17" x2="8" y2="17"></line>
                              </svg>
                              Documents & Photos
                           </h3>
                           <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                              <!-- Photo Upload -->
                              <div class="space-y-2">
                                 <label class="text-sm font-medium text-gray-700 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-green-500">
                                       <rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect>
                                       <circle cx="9" cy="9" r="2"></circle>
                                       <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path>
                                    </svg>
                                    Photo Upload
                                 </label>
                                 <div class="file-upload-area" onclick="document.getElementById('photoInput').click()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-2 text-gray-400">
                                       <rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect>
                                       <circle cx="9" cy="9" r="2"></circle>
                                       <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path>
                                    </svg>
                                    <p class="text-gray-600 text-sm">Click to upload photo</p>
                                    <p class="text-gray-400 text-xs">PNG, JPG up to 10MB</p>
                                 </div>
                                 <input type="file" name="photo" accept="image/*" class="hidden" id="photoInput">
                                 <img id="photoPreview" class="preview-container hidden w-full h-auto" alt="Photo preview">
                              </div>
                              <!-- Document Upload -->
                              <div class="space-y-2">
                                 <label class="text-sm font-medium text-gray-700 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-amber-500">
                                       <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                       <polyline points="14,2 14,8 20,8"></polyline>
                                       <line x1="16" y1="13" x2="8" y2="13"></line>
                                       <line x1="16" y1="17" x2="8" y2="17"></line>
                                    </svg>
                                    Document Upload (ID, License)
                                 </label>
                                 <div class="file-upload-area" onclick="document.getElementById('docInput').click()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-2 text-gray-400">
                                       <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                       <polyline points="14,2 14,8 20,8"></polyline>
                                       <line x1="16" y1="13" x2="8" y2="13"></line>
                                       <line x1="16" y1="17" x2="8" y2="17"></line>
                                    </svg>
                                    <p class="text-gray-600 text-sm">Click to upload document</p>
                                    <p class="text-gray-400 text-xs">ID, License, PDF up to 10MB</p>
                                 </div>
                                 <input type="file" name="document" accept="image/*,.pdf" class="hidden" id="docInput">
                                 <img id="docPreview" class="preview-container hidden w-full h-auto" alt="Document preview">
                              </div>
                           </div>
                        </div>
                        <!-- Submit Button -->
                        <button type="submit"
                           class="w-full px-6 py-4 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 active:scale-95 text-lg">
                           <span class="flex items-center justify-center">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                                 <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                 <circle cx="9" cy="7" r="4"></circle>
                                 <line x1="22" y1="11" x2="16" y2="11"></line>
                                 <line x1="19" y1="8" x2="19" y2="14"></line>
                              </svg>
                              Submit
                           </span>
                        </button>
                     </form>
                  </div>
               </div>
            </div>
            <!-- Result Panel -->
            <div class="lg:col-span-1 transform animate-fade-in" style="animation-delay: 0.2s;">
               <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 overflow-hidden sticky top-8">
                  <div class="px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-600 text-white">
                     <h2 class="text-xl font-semibold flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                           <rect width="5" height="5" x="3" y="3" rx="1"></rect>
                           <rect width="5" height="5" x="16" y="3" rx="1"></rect>
                           <rect width="5" height="5" x="3" y="16" rx="1"></rect>
                           <path d="M21 16h-3a2 2 0 0 0-2 2v3"></path>
                           <path d="M21 21v.01"></path>
                           <path d="M12 7v3a2 2 0 0 1-2 2H7"></path>
                           <path d="M3 12h.01"></path>
                           <path d="M12 3h.01"></path>
                           <path d="M12 16v.01"></path>
                           <path d="M16 12h1"></path>
                           <path d="M21 12v.01"></path>
                           <path d="M12 21v-1"></path>
                        </svg>
                        Registration Result
                     </h2>
                  </div>
                  <div class="p-6">
                     <div id="result" class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-br from-gray-200 to-gray-300 rounded-full flex items-center justify-center mx-auto mb-4">
                           <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500">
                              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                              <circle cx="9" cy="7" r="4"></circle>
                              <line x1="22" y1="11" x2="16" y2="11"></line>
                              <line x1="19" y1="8" x2="19" y2="14"></line>
                           </svg>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-2">Ready to Register</h3>
                        <p class="text-gray-500">Fill out the form to create a new visitor registration with QR code access.</p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <script>
         // Notification system
         function showNotification(message, type = 'success') {
           const notification = document.getElementById('notification');
           const notificationText = document.getElementById('notificationText');
           const notificationIcon = document.getElementById('notificationIcon');

           notification.className = `notification ${type} px-6 py-4 rounded-lg shadow-lg backdrop-blur-sm`;
           notificationText.textContent = message;

           if (type === 'success') {
             notificationIcon.innerHTML = `
               <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                 <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                 <polyline points="22,4 12,14.01 9,11.01"/>
               </svg>
             `;
           } else {
             notificationIcon.innerHTML = `
               <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                 <circle cx="12" cy="12" r="10"/>
                 <line x1="15" y1="9" x2="9" y2="15"/>
                 <line x1="9" y1="9" x2="15" y2="15"/>
               </svg>
             `;
           }

           notification.classList.add('show');

           setTimeout(() => {
             notification.classList.remove('show');
           }, 4000);
         }

         // Load employees and locations into dropdowns
         document.addEventListener('DOMContentLoaded', async () => {
			const hostLabel = document.getElementById('hostEmployeeLabel');
			const hostHidden = document.getElementById('hostEmployeeHidden');
			const locationSelect = document.getElementById('locationSelect');

			try {
				//Load employees
				const currentUser = await fetch('/api/user/session').then(r => r.json());
				hostLabel.textContent = `${currentUser.name} (${currentUser.email})`;
				hostHidden.value = currentUser.id;

				//Load locations
				const locRes = await fetch('/api/location/list');
				const locations = await locRes.json();
				for (const loc of locations) {
					const opt = document.createElement('option');
					opt.value = loc.id;
					opt.textContent = loc.name;
					locationSelect.appendChild(opt);
				}
            } catch (err) {
				 console.error('Failed to load employees/locations:', err);
				 showNotification('Failed to load form data', 'error');
			}

            // Initialize input mask for time
            $('#estimate_time').inputmask({
              mask: "99:99:99",
              placeholder: "hh:mm:ss",
              showMaskOnHover: false,
              showMaskOnFocus: true,
              definitions: {
                '9': {
                  validator: "[0-9]",
                  cardinality: 1
                }
              },
              onBeforePaste: function (pastedValue, opts) {
                return pastedValue.replace(/[^0-9:]/g, '');
              },
              isComplete: function(buffer, opts) {
                const value = buffer.join('');
                const parts = value.split(':');
                if (parts.length !== 3) return false;

                const hours = parseInt(parts[0], 10);
                const minutes = parseInt(parts[1], 10);
                const seconds = parseInt(parts[2], 10);

                return hours >= 0 && hours <= 23 &&
                       minutes >= 0 && minutes <= 59 &&
                       seconds >= 0 && seconds <= 59;
              }
            });
         });

         // Image preview functionality
         function previewImage(inputElement, previewElementId) {
           const file = inputElement.files[0];
           if (file && file.type.startsWith('image/')) {
             const reader = new FileReader();
             reader.onload = function(e) {
               const preview = document.getElementById(previewElementId);
               preview.src = e.target.result;
               preview.style.display = 'block';
               preview.classList.remove('hidden');
             };
             reader.readAsDataURL(file);
           }
         }

         document.getElementById('photoInput').addEventListener('change', function () {
           previewImage(this, 'photoPreview');
         });

         document.getElementById('docInput').addEventListener('change', function () {
           previewImage(this, 'docPreview');
         });

         function reset(){
               form.reset();
               document.getElementById('photoPreview').style.display = 'none';
               document.getElementById('photoPreview').classList.add('hidden');
               document.getElementById('docPreview').style.display = 'none';
               document.getElementById('docPreview').classList.add('hidden');
         }

         // Handle form submission
         document.getElementById('visitorForm').addEventListener('submit', async function(e) {
           e.preventDefault();

           const form = e.target;
           const formData = new FormData(form);
           const submitButton = form.querySelector('button[type="submit"]');
           const resultDiv = document.getElementById('result');

           // Show loading state
           submitButton.disabled = true;
           submitButton.innerHTML = `
             <span class="flex items-center justify-center">
               <svg class="animate-spin -ml-1 mr-3 h-6 w-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                 <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                 <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
               </svg>
               Processing...
             </span>
           `;

           try {
             const res = await fetch('/api/visitor/create', {
               method: 'POST',
               body: formData
             });

             const result = await res.json();

             if (res.ok) {
               // Success result
               resultDiv.innerHTML = `
                 <div class="success-result rounded-2xl p-6">
                   <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full flex items-center justify-center mx-auto mb-4 animate-success-bounce">
                     <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                       <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                       <polyline points="22,4 12,14.01 9,11.01"/>
                     </svg>
                   </div>
                   <h3 class="text-lg font-semibold text-green-800 mb-2">‚úÖ Visitor created</h3>
                   <p class="text-green-700 text-sm mb-4">Registration completed successfully.</p>

                   <div class="bg-white/50 rounded-lg p-4 mb-4">
                     <div class="text-sm text-green-800 mb-2">
                       <strong>Token:</strong> <code class="bg-green-100 px-2 py-1 rounded">${result.token}</code>
                     </div>
                     <img class="qr-preview mx-auto" src="${result.qr_code_url}" alt="QR Code" />
                     <a href="${result.qr_code_url}" download class="inline-flex items-center justify-center w-full mt-3 px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors duration-200">
                       <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                         <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                         <polyline points="7,10 12,15 17,10"/>
                         <line x1="12" y1="15" x2="12" y2="3"/>
                       </svg>
                       Download QR Code
                     </a>
                   </div>

                   <div class="grid grid-cols-2 gap-2">
                     <button id="sendEmailBtn" title="Send by Email" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white text-sm font-medium rounded-lg transition-colors duration-200 flex items-center justify-center">
                       üìß Email
                     </button>
                     <button id="sendSmsBtn" title="Send by SMS" class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white text-sm font-medium rounded-lg transition-colors duration-200 flex items-center justify-center">
                       üì± SMS
                     </button>
                   </div>
                 </div>
               `;

               // Smooth scroll to result
               setTimeout(() => {
                 window.scrollTo({
                   top: document.body.scrollHeight,
                   behavior: 'smooth'
                 });
               }, 100);

               // Add event listeners for email and SMS buttons
               document.getElementById('sendEmailBtn').addEventListener('click', async () => {
                 const button = document.getElementById('sendEmailBtn');
                 const originalHTML = button.innerHTML;

                 button.disabled = true;
                 button.innerHTML = '<span class="animate-spin">‚è≥</span> Sending...';

                 try {
                   const res = await fetch('/api/visitor/send_email', {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify(result)
                   });
                   const r = await res.json();

                   if (res.ok) {
                     showNotification('Email sent successfully!', 'success');
                   } else {
                     showNotification(r.message || 'Failed to send email', 'error');
                   }
                 } catch (error) {
                   showNotification('Failed to send email', 'error');
                 } finally {
                   button.disabled = false;
                   button.innerHTML = originalHTML;
                 }
               });

               document.getElementById('sendSmsBtn').addEventListener('click', async () => {
                 const button = document.getElementById('sendSmsBtn');
                 const originalHTML = button.innerHTML;

                 button.disabled = true;
                 button.innerHTML = '<span class="animate-spin">‚è≥</span> Sending...';

                 try {
                   const res = await fetch('/api/visitor/send_sms', {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify(result)
                   });
                   const r = await res.json();

                   if (res.ok) {
                     showNotification('SMS sent successfully!', 'success');
                   } else {
                     showNotification(r.message || 'Failed to send SMS', 'error');
                   }
                 } catch (error) {
                   showNotification('Failed to send SMS', 'error');
                 } finally {
                   button.disabled = false;
                   button.innerHTML = originalHTML;
                 }
               });

               showNotification('Visitor registered successfully!', 'success');

               // Reset form and hide previews


             } else {
               // Error result
               resultDiv.innerHTML = `
                 <div class="error-result rounded-2xl p-6">
                   <div class="w-16 h-16 bg-gradient-to-br from-red-400 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-4">
                     <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                       <circle cx="12" cy="12" r="10"/>
                       <line x1="15" y1="9" x2="9" y2="15"/>
                       <line x1="9" y1="9" x2="15" y2="15"/>
                     </svg>
                   </div>
                   <h3 class="text-lg font-semibold text-red-800 mb-2">‚ùå Error</h3>
                   <p class="text-red-700 text-sm">${result.error || 'Unknown error'}</p>
                 </div>
               `;
               showNotification(result.error || 'Registration failed', 'error');
             }
           } catch (error) {
             console.error('Error submitting form:', error);
             resultDiv.innerHTML = `
               <div class="error-result rounded-2xl p-6">
                 <div class="w-16 h-16 bg-gradient-to-br from-red-400 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-4">
                   <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                     <circle cx="12" cy="12" r="10"/>
                     <line x1="15" y1="9" x2="9" y2="15"/>
                     <line x1="9" y1="9" x2="15" y2="15"/>
                   </svg>
                 </div>
                 <h3 class="text-lg font-semibold text-red-800 mb-2">‚ùå Network Error</h3>
                 <p class="text-red-700 text-sm">Failed to connect to the server. Please try again.</p>
               </div>
             `;
             showNotification('Network error occurred', 'error');
           } finally {
             // Restore button state
             submitButton.disabled = false;
             submitButton.innerHTML = `
               <span class="flex items-center justify-center">
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                   <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                   <circle cx="9" cy="7" r="4"></circle>
                   <line x1="22" y1="11" x2="16" y2="11"></line>
                   <line x1="19" y1="8" x2="19" y2="14"></line>
                 </svg>
                 Submit
               </span>
             `;
           }
         });
      </script>
   </body>
</html>